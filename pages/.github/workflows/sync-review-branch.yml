name: Sync Review Branch

on:
  push:
    branches: [ main ]

jobs:
  sync-review:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create or update review branch
        run: |
          # ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ–ãƒ©ãƒ³ãƒå
          REVIEW_BRANCH="review-branch"

          # ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ–ãƒ©ãƒ³ãƒãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
          if git ls-remote --heads origin $REVIEW_BRANCH | grep -q $REVIEW_BRANCH; then
            echo "Review branch exists, updating it"
            git checkout -b $REVIEW_BRANCH origin/$REVIEW_BRANCH
            git reset --hard origin/main
            git push origin $REVIEW_BRANCH --force
          else
            echo "Creating new review branch"
            git checkout -b $REVIEW_BRANCH
            git push origin $REVIEW_BRANCH --set-upstream
          fi

      - name: Create or update PR
        run: |
          REVIEW_BRANCH="review-branch"

          # æ—¢å­˜ã®PRã‚’ãƒã‚§ãƒƒã‚¯
          EXISTING_PR=$(gh pr list --base main --head $REVIEW_BRANCH --json number --jq '.[0].number // empty')

          if [ -n "$EXISTING_PR" ]; then
            echo "PR #$EXISTING_PR already exists, it will be automatically updated"
          else
            echo "Creating new PR for review"
            gh pr create \
              --base main \
              --head $REVIEW_BRANCH \
              --title "ğŸ¤– Automated Review PR" \
              --body "ã“ã®PRã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚mainãƒ–ãƒ©ãƒ³ãƒã®å¤‰æ›´ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

Claudeã«ã‚ˆã‚‹è‡ªå‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è¿½åŠ ã•ã‚Œã¾ã™ã€‚"
          fi
